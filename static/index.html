<!DOCTYPE HTML>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Inscripción de cédula</title>

        <link href="style.css" rel="stylesheet">
        <link href="reset.css" rel="stylesheet">
        <link href="plugins.css" rel="stylesheet">
        <link href="color.css" rel="stylesheet">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="antixss.js" type="text/javascript"></script>
        <script src="js/plugins.js" type="text/javascript"></script>
        <script src="js/scripts.js" type="text/javascript"></script>

        <style type="text/css">
            input{
                float: left;
                border: 1px solid #eee;
                background: #f9f9f9;
                width: 100%;
                padding: 15px 20px 15px 55px;
                border-radius: 6px;
                color: #666;
                font-size: 13px;
                -webkit-appearance: none;
            }
            button{
                float: left;
                outline: none;
                border: none;
                cursor: pointer;
                margin-top: 30px;
                background: #4DB7FE;
                color: #fff;
                padding: 15px 40px;
                margin: 15px 40px;
                -webkit-appearance: none;
            }
        </style>
    </head>
    <body>
        <!--loader-->
        <div class="loader-wrap">
            <div class="pin"></div>
            <div class="pulse"></div>
        </div>
        <!--loader end-->
        <!-- Main  -->
        <div id="main">
            <!-- header-->
            <header class="main-header dark-header fs-header sticky">
                <div class="header-inner">
                    <div class="logo-holder">
                        <a href="index.html"><img src="images/logo.png" alt=""></a>
                    </div>
                    <a href="./" class="add-list">Nueva consulta <span><i class="fa fa-plus"></i></span></a>
                    <div class="show-reg-form modal-open"><i class="fa fa-sign-in"></i>Sign In</div>
                    <!-- nav-button-wrap-->
                    <div class="nav-button-wrap color-bg">
                        <div class="nav-button">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                    <!-- nav-button-wrap end-->
                    <!--  navigation -->
                    <div class="nav-holder main-menu">
                        <nav>
                            <ul>
                                <li>
                                    <a> Nuestra suite <i class="fa fa-caret-down"></i></a>
                                    <!--second level -->
                                    <ul>
                                        <li><a href="about.html">Trata de personas para aeropuertos y terminales</a></li>
                                        <li><a href="contacts.html">Prontamente ...</a></li>
                                    </ul>
                                    <!--second level end-->
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <!-- navigation  end -->
                </div>
            </header>
            <!--  header end -->
            <!--  wrapper  -->
            <div id="wrapper">
                <!-- Content-->
                <div class="content">
                    <!--section -->
                    <section id="sec2">
                        <div class="container">
                            <!-- profile-edit-wrap -->
                            <div class="profile-edit-wrap">
                                <div class="row">
                                    <div class="col-md-12">
                                        <!-- profile-edit-container--> 
                                        <div class="profile-edit-container">
                                            <div class="identificacion">
                                                <div class="container">
                                                    <div class="section-title">
                                                        <h2>Búsqueda por identificación</h2>
                                                        <div class="section-subtitle">Identificación</div>
                                                        <span class="section-separator"></span>
                                                        <p>Para la identificación de trata de personas</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-md-offset-4">
                                                    <div class="input-group-lg center-block">
                                                        <p>¿Cuál es el número de identificación?</p>
                                                        <input id="identificacion" type="text" value=""/>
                                                    </div><br>
                                                    <div class="row">
                                                        <button id="boton_consultar">Consultar</button>
                                                    </div>
                                                    <br><br><br>
                                                    <div class="row">
                                                        <div class="list-single-main-item fl-wrap">
                                                            <ul>
                                                                <li id="nombres"><i class="fa fa-circle"></i> Nombres: </li>
                                                                <li id="cedula"><i class="fa fa-circle"></i> Cedula: </li>
                                                                <li id="pension"><i class="fa fa-circle"></i> Pensión: </li>
                                                                <li id="genero"><i class="fa fa-circle"></i> Género: </li>
                                                                <li id="regimen"><i class="fa fa-circle"></i> Régimen: </li>
                                                                <li id="estrato"><i class="fa fa-circle"></i> Estrato: </li>
                                                                <li id="residencia"><i class="fa fa-circle"></i> Residencia: </li>
                                                                <li id="edad"><i class="fa fa-circle"></i> Edad: </li>
                                                                <li id="prediccion"><i class="fa fa-circle"></i> Posible caso: </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6"></div>
                                                        <div class="col-md-6"><button id="ir_voz">Ir al siguiente filtro</button></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="audio" style="display: none;">
                                                <div class="container">
                                                    <div class="section-title">
                                                        <h2>Formulario de preguntas</h2>
                                                        <div class="section-subtitle">Formulario</div>
                                                        <span class="section-separator"></span>
                                                        <p>Para la identificación de trata de personas</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-md-offset-4">
                                                    <h4 align="center">Pregunta uno</h4>
                                                    <audio controls="">
                                                        <source src="https://www.audio-lingua.eu/IMG/mp3/ellie_and_elena_music.mp3" type="audio/mpeg">
                                                    </audio>
                                                    <div id="result-1"></div>
                                                    <p id="result-languague-1"></p>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <button onclick="startConverting('result-1');"><i class="fa fa-microphone"></i></button>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <button id="stop-1"><i class="fa fa-stop"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-md-offset-4">
                                                    <h4 align="center">Pregunta dos</h4>
                                                    <audio controls="">
                                                        <source src="https://www.audio-lingua.eu/IMG/mp3/ellie_and_elena_music.mp3" type="audio/mpeg">
                                                    </audio>
                                                    <div id="result-2"></div>
                                                    <p id="result-languague-2"></p>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <button onclick="startConverting('result-2');"><i class="fa fa-microphone"></i></button>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <button id="stop-2"><i class="fa fa-stop"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-md-offset-4">
                                                    <h4 align="center">Pregunta tres</h4>
                                                    <audio controls="">
                                                        <source src="https://www.audio-lingua.eu/IMG/mp3/ellie_and_elena_music.mp3" type="audio/mpeg">
                                                    </audio>
                                                    <div id="result-3"></div>
                                                    <p id="result-languague-3"></p>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <button onclick="startConverting('result-3');"><i class="fa fa-microphone"></i></button>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <button id="stop-3"><i class="fa fa-stop"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-md-offset-4">
                                                    <h4 align="center">Pregunta cuatro</h4>
                                                    <audio controls="">
                                                        <source src="https://www.audio-lingua.eu/IMG/mp3/ellie_and_elena_music.mp3" type="audio/mpeg">
                                                    </audio>
                                                    <div id="result-4"></div>
                                                    <p id="result-languague-4"></p>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <button onclick="startConverting('result-4');"><i class="fa fa-microphone"></i></button>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <button id="stop-4"><i class="fa fa-stop"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6"></div>
                                                    <div class="col-md-6"><button id="ir_foto">Ir al siguiente filtro</button></div>
                                                </div>
                                            </div>
                                            <div class="video" style="display: none;">
                                                <div class="container">
                                                    <div class="section-title">
                                                        <h2>Identificación de rostro</h2>
                                                        <div class="section-subtitle">Foto</div>
                                                        <span class="section-separator"></span>
                                                        <p>Para la identificación de trata de personas</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 col-md-offset-3">
                                                    <div class="input-group-lg center-block">
                                                        <div class="list-single-main-item fl-wrap" style="margin-top: 400px;">
                                                            <video id="video" width="640" height="480" autoplay></video>
                                                        </div>
                                                        <br>
                                                        <div class="list-single-main-item fl-wrap">
                                                            <button id="button-video" style="width: 80%; height: 100%;">Tomar foto</button>
                                                        </div>
                                                        <br>
                                                        <div class="list-single-main-item fl-wrap">
                                                            <canvas id="canvas" width="640" height="480"></canvas>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6"></div>
                                                    <div class="col-md-6"><button id="finish">Enviar notificación</button></div>
                                                </div>
                                            </div>
                                            <div class="finish" style="display: none;">
                                                <div class="container">
                                                    <div class="section-title">
                                                        <h2>Proceso terminado</h2>
                                                        <div class="section-subtitle">Proceso</div>
                                                        <span class="section-separator"></span>
                                                        <p>Ya se terminó el proceso de filtros, consulta al agentes de migración para terminar de identificar a la víctima.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
 
                                        <!-- profile-edit-container end-->                                        
                                    </div>
                                </div>
                            </div>
                            <!--profile-edit-wrap end -->
                        </div>
                    </section>
                    <!-- section end -->
                </div>
                <!-- Content end -->
            </div>
            <!-- wrapper end -->
            <!--footer -->
            <footer class="main-footer dark-footer  ">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="footer-widget fl-wrap">
                                <h3>Sobre nosotros</h3>
                                <div class="footer-contacts-widget fl-wrap">
                                    <p>Somos una compañía enfatizada en ofrecer distintas clases de soluciones para organizaciones en busca de evitar el negocio y profileración de la trata de personas</p>
                                    <ul  class="footer-contacts fl-wrap">
                                        <li><span><i class="fa fa-envelope-o"></i> Mail :</span><a href="#" target="_blank">trata-persona@aluna.com</a></li>
                                        <li> <span><i class="fa fa-map-marker"></i> Adress :</span><a href="#" target="_blank">USA Calle 33 F Sur No 14B - 100</a></li>
                                        <li><span><i class="fa fa-phone"></i> Phone :</span><a href="#">+57(1)3203888113</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="footer-widget fl-wrap">
                                <h3>Últimas noticias</h3>
                                <div class="widget-posts fl-wrap">
                                    <ul>
                                        <li class="clearfix">
                                            <a class="widget-posts-img"><img src="https://png.pngtree.com/element_origin_min_pic/17/03/05/b98595620d0bc75115fb682bd7a54035.jpg" class="respimg" alt=""></a>
                                            <div class="widget-posts-descr">
                                                <a href="#" title="">Se detectaron 3 casos</a>
                                                <span class="widget-posts-date"> 21 de Marzo 2018 </span>
                                            </div>
                                        </li>
                                        <li class="clearfix">
                                            <a class="widget-posts-img"><img src="https://png.pngtree.com/element_origin_min_pic/17/03/05/b98595620d0bc75115fb682bd7a54035.jpg" class="respimg" alt=""></a>
                                            <div class="widget-posts-descr">
                                                <a href="#" title=""> No se detectó ningún caso</a>
                                                <span class="widget-posts-date"> 14 Marzo 2018 </span>
                                            </div>
                                        </li>
                                        <li class="clearfix">
                                            <a class="widget-posts-img"><img src="https://png.pngtree.com/element_origin_min_pic/17/03/05/b98595620d0bc75115fb682bd7a54035.jpg" class="respimg" alt=""></a>
                                            <div class="widget-posts-descr">
                                                <a href="#" title="">Se detectaron 5 casos</a>
                                                <span class="widget-posts-date"> 12 Marzo 2018 </span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="footer-widget fl-wrap">
                                <h3>Nuestras redes sociales</h3>
                                <div id="footer-twiit"></div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="footer-widget fl-wrap">
                                <h3>Más sobre nuestra solución</h3>
                                <div class="subscribe-widget fl-wrap">
                                    <p>¿Quieres más servicios de nuestra Suite?. Por favor contáctanos al correo trata-persona@aluna.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sub-footer fl-wrap">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="about-widget">
                                    <img src="images/logo.png" alt="">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="copyright"> &#169; Aluna 2018 .  All rights reserved.</div>
                            </div>
                            <div class="col-md-4">
                                <div class="footer-social">
                                    <ul>
                                        <li><a href="#" target="_blank" ><i class="fa fa-facebook-official"></i></a></li>
                                        <li><a href="#" target="_blank"><i class="fa fa-twitter"></i></a></li>
                                        <li><a href="#" target="_blank" ><i class="fa fa-chrome"></i></a></li>
                                        <li><a href="#" target="_blank" ><i class="fa fa-vk"></i></a></li>
                                        <li><a href="#" target="_blank" ><i class="fa fa-whatsapp"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
            <!--footer end  -->

            <a class="to-top"><i class="fa fa-angle-up"></i></a>
        </div>
        <!-- Main end -->
        <!--=============== scripts  ===============-->
        <script>
            $("#boton_consultar").click(function(){
                var cedula = $("#identificacion").val();
                console.log(cedula);
                $.ajax({
                  method: "POST",
                  url: "./api/identificacion",
                  contentType: "application/json",
                  data: JSON.stringify({identificacion : cedula})
                })
                .done(function(data) {
                    if(data[0]){
                        $("#nombres").html("");
                        $("#nombres").append('<i class="fa fa-circle"></i>Nombres: ' + data[0]['nombre']);
                        $("#apellidos").html("");
                        $("#apellidos").append('<i class="fa fa-circle"></i> Apellidos: ' + data[0]['apellido']);
                        $("#cedula").html("");
                        $("#cedula").append('<i class="fa fa-circle"></i> Cedula: ' + data[0]['cedula']);
                        $("#pension").html("");
                        $("#pension").append('<i class="fa fa-circle"></i> Pensión: ' + data[0]['pension']);
                        $("#genero").html("");
                        $("#genero").append('<i class="fa fa-circle"></i> Genero: ' + data[0]['genero']);
                        $("#regimen").html("");
                        $("#regimen").append('<i class="fa fa-circle"></i> Régimen: ' + data[0]['regimen']);
                        $("#estrato").html("");
                        $("#estrato").append('<i class="fa fa-circle"></i> Estrato: ' + data[0]['estrato']);
                        $("#residencia").html("");
                        $("#residencia").append('<i class="fa fa-circle"></i> Residencia: ' + data[0]['residencia']);
                        $("#edad").html("");
                        $("#edad").append('<i class="fa fa-circle"></i> Edad: ' + data[0]['edad']);
                        $("#prediccion").html("");
                        $("#prediccion").append('<i class="fa fa-circle"></i> Posible predicción: ' + data[1]["values"][0][14][1]);
                    }
                    else {
                        console.log("No se pudo encontrar el registro");
                    }
                });
            });
        </script>

        <script type="text/javascript">
            var speechRecognizer = null;
            function startConverting (id) {
                if('webkitSpeechRecognition' in window){
                    var r = document.getElementById(id);
                    speechRecognizer = new webkitSpeechRecognition();
                    speechRecognizer.continuous = true;
                    speechRecognizer.interimResults = true;
                    speechRecognizer.lang = 'es-CO';
                    speechRecognizer.start();

                    var finalTranscripts = '';

                    speechRecognizer.onresult = function(event){
                        var interimTranscripts = '';
                        for(var i = event.resultIndex; i < event.results.length; i++){
                            var transcript = event.results[i][0].transcript;
                            transcript.replace("\n", "<br>");
                            if(event.results[i].isFinal){
                                finalTranscripts += transcript;
                            }else{
                                interimTranscripts += transcript;
                            }
                        }
                        r.innerHTML = finalTranscripts + '<span style="color:#999">' + interimTranscripts + '</span>';
                    };
                    speechRecognizer.onerror = function (event) {
                    };
                }else{
                    r.innerHTML = 'No funciona';
                }
            }

            $("#stop-1").click(function(){
                text = $("#result-1").text();
                speechRecognizer.stop();
                $.ajax({
                  method: "POST",
                  url: "./api/audio",
                  contentType: "application/json",
                  data: JSON.stringify({texto : text})
                })
                .done(function(data) {
                    var array = JSON.parse(data);
                    string = ""

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][0]["text"] + " con relevancia de \n";
                    string += array["keywords"][0]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][0]["sentiment"]["label"] + "\n";
                    string += "\n";

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][1]["text"] + " con relevancia de \n";
                    string += array["keywords"][1]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][1]["sentiment"]["label"] + "\n";
                    string += "\n";

                    $("#result-languague-1").text(string);
                }); 
            });

            $("#stop-2").click(function(){
                text = $("#result-2").text();
                speechRecognizer.stop();
                $.ajax({
                  method: "POST",
                  url: "./api/audio",
                  contentType: "application/json",
                  data: JSON.stringify({texto : text})
                })
                .done(function(data) {
                    var array = JSON.parse(data);
                    string = ""

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][0]["text"] + " con relevancia de \n";
                    string += array["keywords"][0]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][0]["sentiment"]["label"] + "\n";
                    string += "\n";

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][1]["text"] + " con relevancia de \n";
                    string += array["keywords"][1]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][1]["sentiment"]["label"] + "\n";
                    string += "\n";

                    $("#result-languague-2").text(string);
                }); 
            });

            $("#stop-3").click(function(){
                text = $("#result-3").text();
                speechRecognizer.stop();
                $.ajax({
                  method: "POST",
                  url: "./api/audio",
                  contentType: "application/json",
                  data: JSON.stringify({texto : text})
                })
                .done(function(data) {
                    var array = JSON.parse(data);
                    string = ""

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][0]["text"] + " con relevancia de \n";
                    string += array["keywords"][0]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][0]["sentiment"]["label"] + "\n";
                    string += "\n";

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][1]["text"] + " con relevancia de \n";
                    string += array["keywords"][1]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][1]["sentiment"]["label"] + "\n";
                    string += "\n";

                    $("#result-languague-3").text(string);
                }); 
            });

            $("#stop-4").click(function(){
                text = $("#result-4").text();
                speechRecognizer.stop();
                $.ajax({
                  method: "POST",
                  url: "./api/audio",
                  contentType: "application/json",
                  data: JSON.stringify({texto : text})
                })
                .done(function(data) {
                    var array = JSON.parse(data);
                    string = ""

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][0]["text"] + " con relevancia de \n";
                    string += array["keywords"][0]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][0]["sentiment"]["label"] + "\n";
                    string += "\n";

                    string += "Palabra más relevante número uno: \n";
                    string += array["keywords"][1]["text"] + " con relevancia de \n";
                    string += array["keywords"][1]["relevance"] + " y sentimiento representativo de \n";
                    string += array["keywords"][1]["sentiment"]["label"] + "\n";
                    string += "\n";

                    $("#result-languague-4").text(string);
                }); 
            });

        </script>

        <script>
            var video = document.getElementById('video');
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');
            var errBack = function(e) {
                console.log('An error has occurred!', e)
            };

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {

                navigator.mediaDevices.getUserMedia({
                    video: true
                }).then(function(stream) {
                    video.src = window.URL.createObjectURL(stream);
                    video.play();
                });
            }
         
            $("#button-video").click(function() {
                context.drawImage(video, 0, 0, 640, 480);
                buffer_img = canvas.toDataURL('image/png').replace(/^data:image\/(png|jpg);base64,/, "");
                console.log(buffer_img);
                $.ajax({
                  method: "POST",
                  url: "./api/video",
                  data: JSON.stringify({buffer: buffer_img})
                })
                .done(function(data) {
                    console.log(data);
                }); 
            });
        </script>

        <script type="text/javascript">
            $("#ir_voz").click(function(){
                $(".identificacion").hide(1000);
                $(".audio").show(1000);
            });

            $("#ir_foto").click(function(){
                $(".audio").hide(1000);
                $(".video").show(1000);
            });

            $("#finish").click(function(){
                $(".video").hide(1000);
                $(".finish").show(1000);
            });
        </script>

    </body>
</html>